<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 40px auto; padding: 0 20px; color: #333; }
        h1, h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .result-box { border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 5px; background-color: #f9f9f9; }
        .result-box h3 { margin-top: 0; }
        .clickbait { color: #d9534f; font-weight: bold; }
        .not-clickbait { color: #5cb85c; font-weight: bold; }
        a { color: #007BFF; text-decoration: none; }
        .feature-analysis-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 1em;}
        .feature-card { border: 1px solid #ddd; border-radius: 5px; padding: 15px; background: #fff; }
        .feature-card h4 { margin-top: 0; }
        .gauge { position: relative; width: 100%; height: 20px; background-color: #f0f0f0; border-radius: 10px; margin-top: 15px; }
        .gauge .range { position: absolute; height: 100%; opacity: 0.7; }
        .gauge .ncb-range { background-color: #5cb85c; border-radius: 10px; }
        .gauge .cb-range { background-color: #d9534f; border-radius: 10px; }
        .gauge .marker { position: absolute; top: -5px; font-size: 24px; transform: translateX(-50%); cursor: help; }
        .gauge-labels { display: flex; justify-content: space-between; font-size: 12px; color: #777; margin-top: 5px; }
        .pro-clickbait { color: #d9534f; }
        .pro-clickbait-mild { color: #f0ad4e; }
        .anti-clickbait { color: #5cb85c; }
        .neutral { color: #777; font-style: italic; }
    </style>
</head>
<body>
    <h1>Analysis Results</h1>
    <a href="/">&larr; Analyze Another Article</a>

    <div class="result-box">
        <h3>Article Headline</h3>
        <p><em>"{{ result.headline }}"</em></p>

        <h3>Social Media Post</h3>
        <p><em>{{ result.post_text }}</em></p>
        <hr>

        <h3>Detection Result</h3>
        <p class="{% if result.is_clickbait == 'CLICKBAIT' %}clickbait{% else %}not-clickbait{% endif %}">
            {{ result.is_clickbait }}
        </p>
        <p><strong>Confidence Score:</strong> {{ result.clickbait_score }}</p>
    </div>
    <h2>Similarity Scores</h2>
    <table>
        <thead>
            <tr>
                <th>Method</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody>
            {% for method, score in result.similarity_scores.items() %}
            <tr>
                <td>{{ method }}</td>
                <td>{{ "%.4f"|format(score) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <h2>Feature Analysis</h2>
    {% if result.post_provided %}
        <p>Showing the most influential features for this prediction, including those from the social media post.</p>
    {% else %}
        <p>Showing the most influential features for this prediction. To see post-related analysis, provide the social media text on the home page.</p>
    {% endif %}
        <p>The visual gauge shows where the article's value (üìç) falls in relation to the typical range for non-clickbait (üü©) and clickbait (üü•) content.</p>

    <div class="feature-analysis-container">
        {% for feature_name, explanation_data in result.explanations.items() %}
        <div class="feature-card">
            <h4>{{ feature_name }}</h4>
            <p class="{{ explanation_data.tag }}">{{ explanation_data.text }}</p>

            {% set viz = explanation_data.visualization %}
            {% if viz %}
            <div class="gauge">
                <div class="range ncb-range" style="left: {{ viz.ncb_pos }}%; width: {{ viz.ncb_width }}%;"></div>
                <div class="range cb-range" style="left: {{ viz.cb_pos }}%; width: {{ viz.cb_width }}%;"></div>
                <div class="marker" style="left: {{ viz.value_pos }}%;" title="Article's Value">üìç</div>
            </div>
            <div class="gauge-labels">
                <span>Low</span>
                <span>High</span>
            </div>
            {% endif %}
        </div>
        {% else %}
        <p>No detailed feature analysis is available.</p>
        {% endfor %}
    </div>
</body>
</html>